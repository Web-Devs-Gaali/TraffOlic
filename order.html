<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Order</title>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!--Bootstrap-->
    <!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    
    <!--Google Map API implementation-->
    <script src="http://maps.google.com/maps/api/js?key=AIzaSyBPjdHSTJrWzHgsupDElC4QhL1PnBZP1b4&sensor=true&region=IN"></script>
    <!--JSON to string-->
    <script src="json2.js" type="text/javascript" charset="utf-8" async defer></script>
    <!--Google maps API usage-->
    <script>
    	
      var infoWindow = new google.maps.InfoWindow;
      


      function writeAddressName(latLng) {
        var geocoder = new google.maps.Geocoder();
        geocoder.geocode({
          "location": latLng
        },
        function(results, status) {
          if (status == google.maps.GeocoderStatus.OK)
            document.getElementById("address").innerHTML = results[0].formatted_address;
          else
            document.getElementById("error").innerHTML += "Unable to retrieve your address" + "<br />";
        });
      }

      function geolocationSuccess(position) {
        var userLatLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
        // Write the formatted address
        writeAddressName(userLatLng);

        var myOptions = {
          zoom : 15,
          center : userLatLng,
          mapTypeId : google.maps.MapTypeId.ROADMAP
        };
        // Draw the map
        var mapObject = new google.maps.Map(document.getElementById("map"), myOptions);
        var trafficLayer = new google.maps.TrafficLayer();
  trafficLayer.setMap(mapObject);
        // Place the marker
        new google.maps.Marker({
          map: mapObject,
          position: userLatLng,
      	  label: "You"});

        mapObject.setCenter(userLatLng);
        
        // Draw a circle around the user position to have an idea of the current localization accuracy
        var circle = new google.maps.Circle({
          center: userLatLng,
          radius: position.coords.accuracy,
          map: mapObject,
          fillColor: '#0000FF',
          fillOpacity: 0.3,
          strokeColor: '#0000FF',
          strokeOpacity: 0.8
        });
        mapObject.fitBounds(circle.getBounds());
      }

      function geolocationError(positionError) {
        document.getElementById("error").innerHTML += "Error: " + positionError.message + "<br />";
      }

      function geolocateUser() {
        // If the browser supports the Geolocation API
        if (navigator.geolocation)
        {
          var positionOptions = {
            enableHighAccuracy: true,
            timeout: 10 * 1000 // 10 seconds
          };
          navigator.geolocation.getCurrentPosition(geolocationSuccess, geolocationError, positionOptions);
        }
        else
          document.getElementById("error").innerHTML += "Your browser doesn't support the Geolocation API";
      	//searching
      	var request = {
    	location: pyrmont,
    	radius: '500',
    	type: ['bus_station']
  		};
      	service = new google.maps.places.PlacesService(mapObject);
		service.nearbySearch(request, callback);
      }

      function callback(results, status) {
  		if (status == google.maps.places.PlacesServiceStatus.OK) {
    		for (var i = 0; i < results.length; i++) {
      		var place = results[i];
      		createMarker(results[i]);
    		}
  		}
	}

      window.onload = geolocateUser;
    </script>
    <style type="text/css">
      #map {
        width: 100%;
        height: 85%;
      }
      html,body
      {
      	height: 100%;
      	margin: 0px;
      }
      h1
      {
      	text-align: center;
      }
    </style>
  </head>
  <body>
    <h1>Choose your location</h1>
    <div class="container-fluid" id="map"></div>
    <p><b>Address</b>: <span id="address"></span></p>
    <p id="error"></p>
  </body>
</html>